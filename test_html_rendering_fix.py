#!/usr/bin/env python3
"""
–¢–µ—Å—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º—ã —Å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º —Å—ã—Ä–æ–≥–æ HTML –≤ —á–∞—Ç–µ
"""

import streamlit as st
import sys
import os

# –î–æ–±–∞–≤–ª—è–µ–º –ø—É—Ç—å –∫ utils
sys.path.append(os.path.join(os.path.dirname(__file__), 'utils'))

def test_html_rendering():
    """–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ HTML"""
    
    st.title("üß™ –¢–µ—Å—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è HTML —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞")
    
    # –¢–µ—Å—Ç–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è —Å HTML –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º
    test_messages = [
        {
            "role": "user",
            "content": "–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π —ç—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç"
        },
        {
            "role": "assistant", 
            "content": """–†–µ–∑—É–ª—å—Ç–∞—Ç –∞–Ω–∞–ª–∏–∑–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞:

<table>
<thead>
<tr>
<th>–¢–æ–≤–∞—Ä</th>
<th>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</th>
<th>–¶–µ–Ω–∞</th>
<th>–°—É–º–º–∞</th>
</tr>
</thead>
<tbody>
<tr>
<td>–•–ª–µ–± –±–µ–ª—ã–π</td>
<td>2 —à—Ç</td>
<td>45.00</td>
<td>90.00</td>
</tr>
<tr>
<td>–ú–æ–ª–æ–∫–æ 3.2%</td>
<td>1 –ª</td>
<td>75.00</td>
<td>75.00</td>
</tr>
<tr>
<td>–ú–∞—Å–ª–æ —Å–ª–∏–≤–æ—á–Ω–æ–µ</td>
<td>200 –≥</td>
<td>120.00</td>
<td>120.00</td>
</tr>
</tbody>
</table>

–û–±—â–∞—è —Å—É–º–º–∞: 285.00 —Ä—É–±.

–î–æ–∫—É–º–µ–Ω—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç —á–µ–∫ —Å —Ç—Ä–µ–º—è –ø–æ–∑–∏—Ü–∏—è–º–∏ —Ç–æ–≤–∞—Ä–æ–≤."""
        },
        {
            "role": "user",
            "content": "–°–ø–∞—Å–∏–±–æ –∑–∞ –∞–Ω–∞–ª–∏–∑!"
        },
        {
            "role": "assistant",
            "content": "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞! –ï—Å–ª–∏ –Ω—É–∂–Ω–æ –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –¥—Ä—É–≥–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã, –ø—Ä–æ—Å—Ç–æ –∑–∞–≥—Ä—É–∑–∏—Ç–µ –∏—Ö."
        }
    ]
    
    st.subheader("üìù –¢–µ—Å—Ç–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è")
    
    # –í—ã–±–æ—Ä –º–µ—Ç–æ–¥–∞ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
    render_method = st.selectbox(
        "–í—ã–±–µ—Ä–∏—Ç–µ –º–µ—Ç–æ–¥ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è:",
        ["–£–º–Ω—ã–π —Ä–µ–Ω–¥–µ—Ä–µ—Ä (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π)", "–°—Ç–∞—Ä—ã–π –º–µ—Ç–æ–¥ (—Å –ø—Ä–æ–±–ª–µ–º–æ–π)"]
    )
    
    st.divider()
    
    # –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π
    for i, message in enumerate(test_messages):
        
        # –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä —Ä–æ–ª–∏
        if message["role"] == "user":
            st.markdown("üë§ **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:**")
        else:
            st.markdown("ü§ñ **–ê—Å—Å–∏—Å—Ç–µ–Ω—Ç:**")
        
        # –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –º–µ—Ç–æ–¥–∞
        if render_method == "–£–º–Ω—ã–π —Ä–µ–Ω–¥–µ—Ä–µ—Ä (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π)":
            try:
                from utils.smart_content_renderer import SmartContentRenderer
                SmartContentRenderer.render_content_smart(message["content"])
            except ImportError as e:
                st.error(f"–û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞: {e}")
                st.markdown(message["content"])
        else:
            # –°—Ç–∞—Ä—ã–π –º–µ—Ç–æ–¥ - –ø—Ä–æ—Å—Ç–æ markdown –±–µ–∑ unsafe_allow_html
            st.markdown(message["content"])
        
        if i < len(test_messages) - 1:
            st.divider()
    
    # –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–µ—Å—Ç–µ
    st.sidebar.markdown("### ‚ÑπÔ∏è –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–µ—Å—Ç–µ")
    st.sidebar.markdown("""
    **–ü—Ä–æ–±–ª–µ–º–∞:** –í —á–∞—Ç–µ –æ—Ç–æ–±—Ä–∞–∂–∞–ª—Å—è —Å—ã—Ä–æ–π HTML –∫–æ–¥ –≤–º–µ—Å—Ç–æ –æ—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü.
    
    **–†–µ—à–µ–Ω–∏–µ:** –°–æ–∑–¥–∞–Ω —É–º–Ω—ã–π —Ä–µ–Ω–¥–µ—Ä–µ—Ä –∫–æ–Ω—Ç–µ–Ω—Ç–∞, –∫–æ—Ç–æ—Ä—ã–π:
    - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ HTML
    - –ü—Ä–∞–≤–∏–ª—å–Ω–æ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç —Ç–∞–±–ª–∏—Ü—ã
    - –ë–µ–∑–æ–ø–∞—Å–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç HTML –∫–æ–Ω—Ç–µ–Ω—Ç
    
    **–°—Ä–∞–≤–Ω–∏—Ç–µ:** 
    - –£–º–Ω—ã–π —Ä–µ–Ω–¥–µ—Ä–µ—Ä –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–∞–±–ª–∏—Ü—É –∫—Ä–∞—Å–∏–≤–æ
    - –°—Ç–∞—Ä—ã–π –º–µ—Ç–æ–¥ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—ã—Ä—ã–µ HTML —Ç–µ–≥–∏
    """)

def main():
    """–ì–ª–∞–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è"""
    
    st.set_page_config(
        page_title="–¢–µ—Å—Ç HTML —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞",
        page_icon="üß™",
        layout="wide"
    )
    
    test_html_rendering()

if __name__ == "__main__":
    main()