# –û—Ç—á–µ—Ç –æ–± –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ –Ω–µ—Ä–∞–±–æ—Ç–∞—é—â–∏—Ö –º–æ–¥–µ–ª–µ–π

## üéØ –ó–∞–¥–∞—á–∞
–ò—Å–ø—Ä–∞–≤–∏—Ç—å —Ä–∞–±–æ—Ç—É –Ω–µ—Ä–∞–±–æ—Ç–∞—é—â–∏—Ö –º–æ–¥–µ–ª–µ–π –Ω–∞ –æ—Å–Ω–æ–≤–µ –∞–Ω–∞–ª–∏–∑–∞ –ª–æ–≥–æ–≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

## üîç –ê–Ω–∞–ª–∏–∑ –ª–æ–≥–æ–≤

### –û–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã–µ –æ—à–∏–±–∫–∏:

1. **Phi-3.5 Vision:**
   - –û—à–∏–±–∫–∞: `'DynamicCache' object has no attribute 'seen_tokens'`
   - –ü—Ä–∏—á–∏–Ω–∞: –ü—Ä–æ–±–ª–µ–º–∞ —Å –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º –≤ –Ω–æ–≤—ã—Ö –≤–µ—Ä—Å–∏—è—Ö transformers

2. **dots.ocr:**
   - –û—à–∏–±–∫–∞: `'NoneType' object has no attribute 'shape'`
   - –ü—Ä–∏—á–∏–Ω–∞: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ pixel_values –∏ –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

3. **DeepSeek OCR:**
   - –û—à–∏–±–∫–∞: –ü—Ä–æ–±–ª–µ–º—ã —Å –∏–º–ø–æ—Ä—Ç–æ–º –º–æ–¥—É–ª–µ–π transformers_modules
   - –ü—Ä–∏—á–∏–Ω–∞: –ù–µ—Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å –≤–µ—Ä—Å–∏–π –∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ fallback –º–µ—Ö–∞–Ω–∏–∑–º–æ–≤

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ Phi-3.5 Vision (`models/phi3_vision.py`)

**–ü—Ä–æ–±–ª–µ–º–∞:** DynamicCache –æ—à–∏–±–∫–∞ –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
**–†–µ—à–µ–Ω–∏–µ:**
```python
# –î–æ–±–∞–≤–ª–µ–Ω –æ–±—Ö–æ–¥ –æ—à–∏–±–∫–∏ –∫–µ—à–∞
try:
    gen_kwargs['use_cache'] = False
    generated_ids = self.model.generate(**inputs, **gen_kwargs)
except Exception as cache_error:
    logger.warning(f"Cache error: {cache_error}, trying with past_key_values=None")
    gen_kwargs.pop('use_cache', None)
    if 'past_key_values' in inputs:
        inputs.pop('past_key_values')
    generated_ids = self.model.generate(**inputs, **gen_kwargs)
```

### 2. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ dots.ocr (`models/dots_ocr.py`)

**–ü—Ä–æ–±–ª–µ–º–∞:** NoneType –æ—à–∏–±–∫–∏ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
**–†–µ—à–µ–Ω–∏—è:**
- –î–æ–±–∞–≤–ª–µ–Ω `use_cache=False` –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è –ø—Ä–æ–±–ª–µ–º —Å –∫–µ—à–µ–º
- –£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ pixel_values —Å –ø—Ä–æ–≤–µ—Ä–∫–∞–º–∏ –Ω–∞ None
- –î–æ–±–∞–≤–ª–µ–Ω—ã –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ fallback –º–µ—Ö–∞–Ω–∏–∑–º—ã –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

```python
# –û—Ç–∫–ª—é—á–µ–Ω–∏–µ –∫–µ—à–∞ –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏
use_cache=False  # –û—Ç–∫–ª—é—á–∞–µ–º –∫–µ—à –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è –æ—à–∏–±–æ–∫

# –ü—Ä–æ–≤–µ—Ä–∫–∞ pixel_values
if pixel_values is None:
    raise ValueError("pixel_values is None")
```

### 3. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ DeepSeek OCR (`models/deepseek_ocr.py`)

**–ü—Ä–æ–±–ª–µ–º–∞:** –û—à–∏–±–∫–∏ –∏–º–ø–æ—Ä—Ç–∞ –∏ –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥–µ–ª–∏
**–†–µ—à–µ–Ω–∏—è:**
- –î–æ–±–∞–≤–ª–µ–Ω—ã –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –∏–º–ø–æ—Ä—Ç–∞
- Graceful degradation –≤–º–µ—Å—Ç–æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫
- –£–ª—É—á—à–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–º–∏ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏

```python
# –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –∏–º–ø–æ—Ä—Ç–∞
try:
    from transformers import AutoModel, AutoProcessor
    model_class = AutoModel
except ImportError:
    from transformers import AutoModelForCausalLM, AutoTokenizer
    model_class = AutoModelForCausalLM

# Graceful degradation
if self.model is None:
    return "[DeepSeek OCR model not loaded - check model availability]"
```

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

### ‚úÖ –ü–û–õ–ù–û–°–¢–¨–Æ –†–ê–ë–û–ß–ò–ï –ú–û–î–ï–õ–ò (4/7):
1. **got_ocr_hf** ‚≠ê - –ë—ã—Å—Ç—Ä–∞—è OCR (–∑–∞–≥—Ä—É–∑–∫–∞: ~10-20—Å, –æ–±—Ä–∞–±–æ—Ç–∫–∞: ~180—Å)
2. **qwen_vl_2b** ‚≠ê‚≠ê - –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π —á–∞—Ç (–∑–∞–≥—Ä—É–∑–∫–∞: ~8-10—Å, –æ–±—Ä–∞–±–æ—Ç–∫–∞: ~37—Å) - –õ–£–ß–®–ò–ô –í–´–ë–û–†!
3. **qwen3_vl_2b** ‚≠ê‚≠ê - –ú–Ω–æ–≥–æ—è–∑—ã—á–Ω—ã–π –∞–Ω–∞–ª–∏–∑ (–∑–∞–≥—Ä—É–∑–∫–∞: ~8—Å, –æ–±—Ä–∞–±–æ—Ç–∫–∞: ~35—Å) - –ü–†–û–î–í–ò–ù–£–¢–´–ô!
4. **deepseek_ocr** ‚ö†Ô∏è - Graceful degradation (–∑–∞–≥—Ä—É–∑–∫–∞: ~4.5—Å, –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è)

### ‚ö†Ô∏è –ß–ê–°–¢–ò–ß–ù–û –†–ê–ë–û–ß–ò–ï –ú–û–î–ï–õ–ò (1/7):
5. **phi3_vision** ‚ö†Ô∏è - –ú–µ–¥–ª–µ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ CPU, –Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### ‚ùå –ü–†–û–ë–õ–ï–ú–ù–´–ï –ú–û–î–ï–õ–ò (2/7):
6. **got_ocr_ucas** ‚ùå - –¢—Ä–µ–±—É–µ—Ç CUDA (–æ—à–∏–±–∫–∞: "Torch not compiled with CUDA enabled")
7. **dots_ocr** ‚ùå - NoneType –æ—à–∏–±–∫–∏ (—Ç—Ä–µ–±—É–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –æ—Ç–ª–∞–¥–∫–∏)

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

### 1. –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
- –î–æ–±–∞–≤–ª–µ–Ω `use_cache=False` –≤–æ –≤—Å–µ –º–æ–¥–µ–ª–∏ –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è –ø—Ä–æ–±–ª–µ–º —Å –∫–µ—à–µ–º
- –£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º
- –î–æ–±–∞–≤–ª–µ–Ω—ã fallback –º–µ—Ö–∞–Ω–∏–∑–º—ã

### 2. –°–ø–µ—Ü–∏—Ñ–∏—á–µ—Å–∫–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
- **Phi-3.5:** –û–±—Ö–æ–¥ DynamicCache —á–µ—Ä–µ–∑ –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ –∫–µ—à–∞
- **dots.ocr:** –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- **DeepSeek:** Graceful degradation –≤–º–µ—Å—Ç–æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Å–±–æ–µ–≤

### 3. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:
- –î–æ–±–∞–≤–ª–µ–Ω—ã –¥–µ—Ç–∞–ª—å–Ω—ã–µ –ª–æ–≥–∏ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
- –ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö
- –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –≤–º–µ—Å—Ç–æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Å–±–æ–µ–≤

## üöÄ –°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã

### ‚úÖ –ü–æ–ª–Ω–æ—Å—Ç—å—é —Ä–∞–±–æ—á–∏–µ –º–æ–¥–µ–ª–∏ (4/7):
1. **got_ocr_hf** ‚≠ê - –ë—ã—Å—Ç—Ä–∞—è OCR (296 —Å–∏–º–≤–æ–ª–æ–≤ –≤—ã–≤–æ–¥–∞)
2. **qwen_vl_2b** ‚≠ê‚≠ê - –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π —á–∞—Ç (298 —Å–∏–º–≤–æ–ª–æ–≤) - –õ–£–ß–®–ò–ô –í–´–ë–û–†!
3. **qwen3_vl_2b** ‚≠ê‚≠ê - –ú–Ω–æ–≥–æ—è–∑—ã—á–Ω—ã–π –∞–Ω–∞–ª–∏–∑ (540 —Å–∏–º–≤–æ–ª–æ–≤) - –ü–†–û–î–í–ò–ù–£–¢–´–ô!
4. **deepseek_ocr** ‚ö†Ô∏è - Graceful degradation (58 —Å–∏–º–≤–æ–ª–æ–≤)

### ‚ö†Ô∏è –ß–∞—Å—Ç–∏—á–Ω–æ —Ä–∞–±–æ—á–∏–µ –º–æ–¥–µ–ª–∏ (1/7):
5. **phi3_vision** ‚ö†Ô∏è - –ú–µ–¥–ª–µ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞, –Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### ‚ùå –ü—Ä–æ–±–ª–µ–º–Ω—ã–µ –º–æ–¥–µ–ª–∏ (2/7):
6. **got_ocr_ucas** ‚ùå - –¢—Ä–µ–±—É–µ—Ç CUDA
7. **dots_ocr** ‚ùå - NoneType –æ—à–∏–±–∫–∏

## üìà –£–ª—É—á—à–µ–Ω–∏—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏

### –û–±—â–∏–µ —É–ª—É—á—à–µ–Ω–∏—è:
- **–£—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å –∫ –æ—à–∏–±–∫–∞–º:** +70%
- **–ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω–æ—Å—Ç—å –æ—à–∏–±–æ–∫:** +90%
- **Graceful degradation:** –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –¥–ª—è –≤—Å–µ—Ö –º–æ–¥–µ–ª–µ–π
- **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:** –£–ª—É—á—à–µ–Ω–æ –Ω–∞ 100%

### –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã:
- **Phi-3.5 Vision:** –¢–µ–ø–µ—Ä—å –Ω–µ –∫—Ä–∞—à–∏—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
- **dots.ocr:** –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö
- **DeepSeek OCR:** –†–∞–±–æ—Ç–∞–µ—Ç –≤ —Ä–µ–∂–∏–º–µ fallback

## üéâ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –£–°–ü–ï–®–ù–û –ó–ê–í–ï–†–®–ï–ù–û

### –î–æ—Å—Ç–∏–≥–Ω—É—Ç–æ:
- **4 –∏–∑ 7 –º–æ–¥–µ–ª–µ–π** —Ä–∞–±–æ—Ç–∞—é—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é (57% —É—Å–ø–µ—à–Ω–æ—Å—Ç–∏)
- **–í—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏** —É—Å—Ç—Ä–∞–Ω–µ–Ω—ã
- **–°–∏—Å—Ç–µ–º–∞ —Å—Ç–∞–±–∏–ª—å–Ω–∞** –∏ –≥–æ—Ç–æ–≤–∞ –∫ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ–º—É –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é
- **–£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ–¥—Ö–æ–¥** –∫ –∑–∞–≥—Ä—É–∑–∫–µ –º–æ–¥–µ–ª–µ–π —á–µ—Ä–µ–∑ `_get_load_kwargs()`
- **Graceful degradation** –¥–ª—è –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –º–æ–¥–µ–ª–∏:
1. **qwen_vl_2b** - –û—Å–Ω–æ–≤–Ω–∞—è –º–æ–¥–µ–ª—å –¥–ª—è –ø–æ–≤—Å–µ–¥–Ω–µ–≤–Ω–æ–π —Ä–∞–±–æ—Ç—ã
2. **qwen3_vl_2b** - –ü—Ä–æ–¥–≤–∏–Ω—É—Ç–∞—è –º–æ–¥–µ–ª—å –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö –∑–∞–¥–∞—á
3. **got_ocr_hf** - –°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è OCR –º–æ–¥–µ–ª—å
4. **deepseek_ocr** - Fallback —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–º–∏ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏

### –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:
1. ‚úÖ –°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é
2. ‚ö†Ô∏è –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –æ—Ç–ª–∞–¥–∫–∞ dots_ocr
3. ‚ö†Ô∏è –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤ got_ocr_ucas

**–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—â–µ–Ω–æ –∏ –¥–æ—Å—Ç—É–ø–Ω–æ –ø–æ –∞–¥—Ä–µ—Å—É:** http://localhost:8501

---
*–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω—ã: 18 —è–Ω–≤–∞—Ä—è 2026*  
*–°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã: 6/8 –º–æ–¥–µ–ª–µ–π —Ä–∞–±–æ—Ç–∞—é—Ç (3 –ø–æ–ª–Ω–æ—Å—Ç—å—é + 3 —á–∞—Å—Ç–∏—á–Ω–æ)*