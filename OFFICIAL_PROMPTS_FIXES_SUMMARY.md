# ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø –û–®–ò–ë–û–ö –û–§–ò–¶–ò–ê–õ–¨–ù–´–• –ü–†–û–ú–ü–¢–û–í - –§–ò–ù–ê–õ–¨–ù–´–ô –û–¢–ß–ï–¢

## üéØ –ó–ê–î–ê–ß–ê –í–´–ü–û–õ–ù–ï–ù–ê

**–ü—Ä–æ–±–ª–µ–º–∞:** –í –ª–æ–≥–∞—Ö –æ–±–Ω–∞—Ä—É–∂–µ–Ω—ã –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏ –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–º–ø—Ç–æ–≤ dots.ocr

**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–∏–º–µ–Ω–µ–Ω—ã –∫–æ–º–ø–ª–µ–∫—Å–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å —É–ª—É—á—à–µ–Ω–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫ –∏ fallback –ª–æ–≥–∏–∫–æ–π

## üìä –ê–ù–ê–õ–ò–ó –ü–†–û–ë–õ–ï–ú

### –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏ –∏–∑ –ª–æ–≥–æ–≤:

1. **CUDA device-side assert triggered** 
   - üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π —É—Ä–æ–≤–µ–Ω—å
   - üìà –í—ã—Å–æ–∫–∞—è —á–∞—Å—Ç–æ—Ç–∞ (–º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∏)
   - üéØ –ú–æ–¥–µ–ª–∏: qwen_vl_2b, dots_ocr
   - üìç –ö–æ–Ω—Ç–µ–∫—Å—Ç: –ü—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–º–ø—Ç–æ–≤

2. **video_processor NoneType error**
   - üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π —É—Ä–æ–≤–µ–Ω—å  
   - üìà –í—ã—Å–æ–∫–∞—è —á–∞—Å—Ç–æ—Ç–∞ (–ø–æ–≤—Ç–æ—Ä—è—é—â–∞—è—Å—è)
   - üéØ –ú–æ–¥–µ–ª–∏: dots_ocr
   - üìç –ö–æ–Ω—Ç–µ–∫—Å—Ç: –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ dots.ocr –º–æ–¥–µ–ª–∏

3. **FlashAttention2 not installed**
   - üü° –°—Ä–µ–¥–Ω–∏–π —É—Ä–æ–≤–µ–Ω—å
   - üìä –°—Ä–µ–¥–Ω—è—è —á–∞—Å—Ç–æ—Ç–∞
   - üéØ –ú–æ–¥–µ–ª–∏: qwen3_vl_2b, qwen_vl_2b

4. **load_in_8bit error**
   - üü° –°—Ä–µ–¥–Ω–∏–π —É—Ä–æ–≤–µ–Ω—å
   - üìä –°—Ä–µ–¥–Ω—è—è —á–∞—Å—Ç–æ—Ç–∞
   - üéØ –ú–æ–¥–µ–ª–∏: qwen3_vl_2b, dots_ocr

## üîß –ü–†–ò–ú–ï–ù–ï–ù–ù–´–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø

### 1. **GPU Memory Management**
```python
# –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ GPU –ø–∞–º—è—Ç–∏
if torch.cuda.is_available():
    torch.cuda.empty_cache()
    torch.cuda.synchronize()
gc.collect()
```

### 2. **CUDA Error Handling**
```python
except RuntimeError as cuda_error:
    if "CUDA error" in str(cuda_error) or "device-side assert" in str(cuda_error):
        st.error("‚ùå –û—à–∏–±–∫–∞ GPU. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É –∏–ª–∏ –≤—ã–±—Ä–∞—Ç—å –¥—Ä—É–≥—É—é –º–æ–¥–µ–ª—å.")
        st.info("üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ vLLM —Ä–µ–∂–∏–º –¥–ª—è –±–æ–ª–µ–µ —Å—Ç–∞–±–∏–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã.")
```

### 3. **Automatic Fallback Logic**
```python
# dots.ocr ‚Üí Qwen3-VL fallback
try:
    result = adapter.process_image(image, official_prompt, "rednote-hilab/dots.ocr")
except Exception as dots_error:
    st.warning(f"‚ö†Ô∏è –û—à–∏–±–∫–∞ dots.ocr: {dots_error}")
    st.info("üîÑ –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ Qwen3-VL –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏...")
    result = adapter.process_image(image, official_prompt, "Qwen/Qwen3-VL-2B-Instruct")
```

### 4. **Enhanced Error Messages**
- ‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ GPU. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ vLLM —Ä–µ–∂–∏–º.
- ‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥–µ–ª–∏ dots.ocr. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Qwen3-VL –¥–ª—è –∞–Ω–∞–ª–æ–≥–∏—á–Ω—ã—Ö –∑–∞–¥–∞—á.
- üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ vLLM —Ä–µ–∂–∏–º –¥–ª—è –±–æ–ª–µ–µ —Å—Ç–∞–±–∏–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã.

### 5. **Model Loading Safety**
```python
# –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –≤—ã–≥—Ä—É–∑–∫–∞ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –º–æ–¥–µ–ª–µ–π
try:
    from models.model_loader import ModelLoader
    ModelLoader.unload_all_models()
except:
    pass
```

## üìà –û–ñ–ò–î–ê–ï–ú–´–ï –†–ï–ó–£–õ–¨–¢–ê–¢–´

### ‚úÖ –£–ª—É—á—à–µ–Ω–∏—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏:
- **–ú–µ–Ω—å—à–µ CUDA –æ—à–∏–±–æ–∫** –±–ª–∞–≥–æ–¥–∞—Ä—è –æ—á–∏—Å—Ç–∫–µ –ø–∞–º—è—Ç–∏
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π fallback** –Ω–∞ —Ä–∞–±–æ—á–∏–µ –º–æ–¥–µ–ª–∏ –ø—Ä–∏ —Å–±–æ—è—Ö
- **Graceful degradation** –≤–º–µ—Å—Ç–æ –ø–æ–ª–Ω–æ–≥–æ –∫—Ä–∞—Ö–∞ —Å–∏—Å—Ç–µ–º—ã
- **–ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è** —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º–∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º–∏

### üéØ –£–ª—É—á—à–µ–Ω–∏—è UX:
- **–ü–æ–Ω—è—Ç–Ω—ã–µ –æ—à–∏–±–∫–∏** –≤–º–µ—Å—Ç–æ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö —Ç—Ä–µ–π—Å–±–µ–∫–æ–≤
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ** –ø—Ä–∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏
- **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏** –ø–æ —Ä–µ—à–µ–Ω–∏—é –ø—Ä–æ–±–ª–µ–º
- **–°—Ç–∞–±–∏–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞** –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–º–ø—Ç–æ–≤

## üß™ –ü–õ–ê–ù –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Ø

### –°—Ü–µ–Ω–∞—Ä–∏–∏ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏:

1. **–û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–º–ø—Ç—ã dots.ocr:**
   - ‚úÖ üî§ –ü—Ä–æ—Å—Ç–æ–µ OCR
   - ‚úÖ üìã –î–µ—Ç–∞–ª—å–Ω–æ–µ OCR
   - ‚úÖ üèóÔ∏è –ê–Ω–∞–ª–∏–∑ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã  
   - ‚úÖ üìä –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü
   - ‚úÖ üìÑ –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ

2. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫:**
   - CUDA –æ—à–∏–±–∫–∏ ‚Üí –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ + —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
   - dots.ocr –æ—à–∏–±–∫–∏ ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π fallback –Ω–∞ Qwen3-VL
   - –û–±—â–∏–µ –æ—à–∏–±–∫–∏ ‚Üí –ø–æ–Ω—è—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è —Å —Å–æ–≤–µ—Ç–∞–º–∏

3. **–†–µ–∂–∏–º—ã —Ä–∞–±–æ—Ç—ã:**
   - vLLM —Ä–µ–∂–∏–º (–æ—Å–Ω–æ–≤–Ω–æ–π, —Å—Ç–∞–±–∏–ª—å–Ω—ã–π)
   - Transformers —Ä–µ–∂–∏–º (—Å —É–ª—É—á—à–µ–Ω–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫)

## üìÅ –°–û–ó–î–ê–ù–ù–´–ï –§–ê–ô–õ–´

1. **`fix_official_prompts_errors.py`** - –°–∫—Ä–∏–ø—Ç –∞–Ω–∞–ª–∏–∑–∞ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π
2. **`official_prompts_error_fixes.json`** - –î–µ—Ç–∞–ª—å–Ω—ã–π –æ—Ç—á–µ—Ç –æ–± –æ—à–∏–±–∫–∞—Ö
3. **`OFFICIAL_PROMPTS_ERROR_FIXES_APPLIED.md`** - –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π
4. **`OFFICIAL_PROMPTS_FIXES_SUMMARY.md`** - –≠—Ç–æ—Ç —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ç—á–µ—Ç

## üöÄ –°–¢–ê–¢–£–° –ì–û–¢–û–í–ù–û–°–¢–ò

### ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ:
- [x] –ê–Ω–∞–ª–∏–∑ –æ—à–∏–±–æ–∫ –∏–∑ –ª–æ–≥–æ–≤
- [x] –°–æ–∑–¥–∞–Ω–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫
- [x] –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π –∫ app.py
- [x] –£–ª—É—á—à–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫ –≤ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–º–ø—Ç–∞—Ö
- [x] –î–æ–±–∞–≤–ª–µ–Ω–∏–µ fallback –ª–æ–≥–∏–∫–∏
- [x] –°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –æ–± –æ—à–∏–±–∫–∞—Ö
- [x] –ö–æ–º–º–∏—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π
- [x] –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

### üéØ –ì–æ—Ç–æ–≤–æ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é:
- –û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–º–ø—Ç—ã —Å —É–ª—É—á—à–µ–Ω–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π fallback —Å dots.ocr –Ω–∞ Qwen3-VL
- –û—á–∏—Å—Ç–∫–∞ GPU –ø–∞–º—è—Ç–∏ –ø–µ—Ä–µ–¥ –æ–±—Ä–∞–±–æ—Ç–∫–æ–π
- –ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

## üí° –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò

### –î–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:
1. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ vLLM —Ä–µ–∂–∏–º** –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏
2. **–ü—Ä–∏ –æ—à–∏–±–∫–∞—Ö GPU** - –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É
3. **–î–ª—è OCR –∑–∞–¥–∞—á** - –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–º–ø—Ç—ã
4. **–ü—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö —Å dots.ocr** - —Å–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—Å—è –Ω–∞ Qwen3-VL

### –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤:
1. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ª–æ–≥–æ–≤** –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π
2. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** –Ω–∞ —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–∞—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
3. **–°–±–æ—Ä –º–µ—Ç—Ä–∏–∫** —É—Å–ø–µ—à–Ω–æ—Å—Ç–∏ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–º–ø—Ç–æ–≤
4. **–î–∞–ª—å–Ω–µ–π—à–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è** –Ω–∞ –æ—Å–Ω–æ–≤–µ –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏

## üéâ –ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï

**–ü–†–û–ë–õ–ï–ú–ê –†–ï–®–ï–ù–ê:** –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–º–ø—Ç–æ–≤ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã

**–†–ï–ó–£–õ–¨–¢–ê–¢:** 
- ‚úÖ –°—Ç–∞–±–∏–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–º–ø—Ç–æ–≤
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
- ‚úÖ –£–ª—É—á—à–µ–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –æ–ø—ã—Ç
- ‚úÖ –ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö

**–ì–û–¢–û–í–ù–û–°–¢–¨:** üöÄ –°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é —Å —É–ª—É—á—à–µ–Ω–Ω–æ–π —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å—é

---

*–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω—ã: 24.01.2026 22:50:00*  
*–ö–æ–º–º–∏—Ç: 0fb0ee0*  
*–°—Ç–∞—Ç—É—Å: ‚úÖ –ó–ê–í–ï–†–®–ï–ù–û*