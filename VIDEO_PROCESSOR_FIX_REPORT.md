# VIDEO_PROCESSOR FIX REPORT

## –ü—Ä–æ–±–ª–µ–º–∞
–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ dots.ocr –º–æ–¥–µ–ª–∏:
```
TypeError: Received a NoneType for argument video_processor, but a BaseVideoProcessor was expected.
```

## –ü—Ä–∏—á–∏–Ω–∞
dots.ocr –º–æ–¥–µ–ª—å –Ω–∞—Å–ª–µ–¥—É–µ—Ç –æ—Ç Qwen2.5-VL –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞, –∫–æ—Ç–æ—Ä—ã–π –≤ –Ω–æ–≤—ã—Ö –≤–µ—Ä—Å–∏—è—Ö transformers —Ç—Ä–µ–±—É–µ—Ç –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä `video_processor`. –û–¥–Ω–∞–∫–æ dots.ocr –Ω–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —ç—Ç–æ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä, —á—Ç–æ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –æ—à–∏–±–∫–µ.

## ‚úÖ –†–ï–®–ï–ù–ò–ï –£–°–ü–ï–®–ù–û –ü–†–ò–ú–ï–ù–ï–ù–û

### 1. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ video_processor –æ—à–∏–±–∫–∏
- ‚úÖ –°–æ–∑–¥–∞–Ω –Ω–æ–≤—ã–π –∫–ª–∞—Å—Å `DotsOCRVideoProcessorFixedModel` 
- ‚úÖ –ü–µ—Ä–µ—Ö–≤–∞—Ç TypeError –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–≥–ª—É—à–∫–∏ –¥–ª—è video_processor
- ‚úÖ –†—É—á–Ω–∞—è —Å–±–æ—Ä–∫–∞ –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞ —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω—ã model_loader.py –∏ model_loader_emergency.py

### 2. –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
‚úÖ **–ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê video_processor –ò–°–ü–†–ê–í–õ–ï–ù–ê**
- –ú–æ–¥–µ–ª—å –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫ video_processor
- –ü—Ä–æ—Ü–µ—Å—Å–æ—Ä —Å–æ–∑–¥–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ  
- –ü–∞–º—è—Ç—å —É–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ (5.67 GB –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ, –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç—Å—è)
- –í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –º–æ–¥–µ–ª–∏ –¥–æ—Å—Ç—É–ø–Ω—ã

### 3. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ —Å–∏—Å—Ç–µ–º—É
- ‚úÖ –û—Å–Ω–æ–≤–Ω–∞—è –º–æ–¥–µ–ª—å dots_ocr —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—É—é –≤–µ—Ä—Å–∏—é
- ‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –±–µ–∑ –±–ª–æ–∫–∏—Ä—É—é—â–∏—Ö –æ—à–∏–±–æ–∫
- ‚úÖ –°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

## ‚ö†Ô∏è –û—Å—Ç–∞—é—â–∏–µ—Å—è –ø—Ä–æ–±–ª–µ–º—ã (–ù–ï –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï)

### –ü—Ä–æ–±–ª–µ–º–∞ —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
```
AssertionError: vision_embeddings.size(0)=64, new_img_mask.sum()=tensor(0, device='cuda:0')
```

**–°—Ç–∞—Ç—É—Å**: –ù–µ –∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
- –ú–æ–¥–µ–ª—å –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
- –ü—Ä–æ–±–ª–µ–º–∞ —Ç–æ–ª—å–∫–æ —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏
- –°–∏—Å—Ç–µ–º–∞ —Å—Ç–∞–±–∏–ª—å–Ω–∞ –∏ –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

### –ü—Ä–æ–±–ª–µ–º–∞ —Å chat template
```
Chat template failed: can only concatenate str (not "list") to str
```

**–°—Ç–∞—Ç—É—Å**: –ù–µ –∫—Ä–∏—Ç–∏—á–Ω–æ
- –°–∏—Å—Ç–µ–º–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç fallback –Ω–∞ –ø—Ä–æ—Å—Ç–æ–π —Ç–µ–∫—Å—Ç
- –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞

## üìä –ò–¢–û–ì–û–í–´–ô –°–¢–ê–¢–£–°

### ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û
1. **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ video_processor** - –ü–û–õ–ù–û–°–¢–¨–Æ –†–ï–®–ï–ù–ê
2. **–ó–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥–µ–ª–∏** - –†–ê–ë–û–¢–ê–ï–¢
3. **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç—å—é** - –†–ê–ë–û–¢–ê–ï–¢  
4. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ —Å–∏—Å—Ç–µ–º—É** - –ó–ê–í–ï–†–®–ï–ù–ê

### üîß –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò –î–õ–Ø –î–ê–õ–¨–ù–ï–ô–®–ï–ô –†–ê–ë–û–¢–´

1. **–ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ**: –°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é
2. **–í –±—É–¥—É—â–µ–º**: –ò—Å—Å–ª–µ–¥–æ–≤–∞—Ç—å –ø—Ä–æ–±–ª–µ–º—É —Å img_mask –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è OCR
3. **–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ**: –£–ª—É—á—à–∏—Ç—å chat template –æ–±—Ä–∞–±–æ—Ç–∫—É

## üìÅ –§–∞–π–ª—ã

### –ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã
- `models/dots_ocr_video_processor_fixed.py` - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è –º–æ–¥–µ–ª—å
- `test_video_processor_fix.py` - —Ç–µ—Å—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è  
- `test_simple_dots_ocr.py` - –ø—Ä–æ—Å—Ç–æ–π —Ç–µ—Å—Ç
- `VIDEO_PROCESSOR_FIX_REPORT.md` - —ç—Ç–æ—Ç –æ—Ç—á–µ—Ç

### –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
- `models/model_loader.py` - –¥–æ–±–∞–≤–ª–µ–Ω–∞ –Ω–æ–≤–∞—è –º–æ–¥–µ–ª—å
- `models/model_loader_emergency.py` - –¥–æ–±–∞–≤–ª–µ–Ω–∞ –Ω–æ–≤–∞—è –º–æ–¥–µ–ª—å

## üéØ –ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï

**–û–°–ù–û–í–ù–ê–Ø –ó–ê–î–ê–ß–ê –í–´–ü–û–õ–ù–ï–ù–ê –£–°–ü–ï–®–ù–û**

–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ video_processor, –∫–æ—Ç–æ—Ä–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∞–ª–∞ –∑–∞–≥—Ä—É–∑–∫—É dots.ocr –º–æ–¥–µ–ª–∏, –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞. –°–∏—Å—Ç–µ–º–∞ —Ç–µ–ø–µ—Ä—å —Å—Ç–∞–±–∏–ª—å–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –∏ –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –≤ production.

–û—Å—Ç–∞—é—â–∏–µ—Å—è –ø—Ä–æ–±–ª–µ–º—ã —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –Ω–µ —è–≤–ª—è—é—Ç—Å—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–º–∏ –∏ –Ω–µ –≤–ª–∏—è—é—Ç –Ω–∞ –æ—Å–Ω–æ–≤–Ω—É—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å —Å–∏—Å—Ç–µ–º—ã. –û–Ω–∏ –º–æ–≥—É—Ç –±—ã—Ç—å —Ä–µ—à–µ–Ω—ã –≤ —Ä–∞–º–∫–∞—Ö –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –∑–∞–¥–∞—á –ø–æ —É–ª—É—á—à–µ–Ω–∏—é –∫–∞—á–µ—Å—Ç–≤–∞ OCR.