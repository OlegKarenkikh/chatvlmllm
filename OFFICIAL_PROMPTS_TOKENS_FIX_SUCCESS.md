# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ª–∏–º–∏—Ç–∞ —Ç–æ–∫–µ–Ω–æ–≤ –¥–ª—è –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–º–ø—Ç–æ–≤ dots.ocr

## –ü—Ä–æ–±–ª–µ–º–∞
–û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–º–ø—Ç—ã dots.ocr –Ω–µ —Ä–∞–±–æ—Ç–∞–ª–∏ –∏–∑-–∑–∞ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –≤ 1024 —Ç–æ–∫–µ–Ω–∞ –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ vLLM –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞. –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –≤–æ–∑–≤—Ä–∞—â–∞–ª–∏ –æ—à–∏–±–∫—É:

```
'max_tokens' or 'max_completion_tokens' is too large: 2000. 
This model's maximum context length is 1024 tokens and your request has 218 input tokens 
(2000 > 1024 - 218). (parameter=max_tokens, value=2000)
```

## –†–µ—à–µ–Ω–∏–µ
–£–≤–µ–ª–∏—á–µ–Ω –ª–∏–º–∏—Ç —Ç–æ–∫–µ–Ω–æ–≤ –≤ `docker-compose-vllm.yml` –¥–ª—è —Å–µ—Ä–≤–∏—Å–∞ `dots-ocr`:

### –ò–∑–º–µ–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
```yaml
# –ë–´–õ–û:
--max-model-len 1024

# –°–¢–ê–õ–û:
--max-model-len 4096
```

### –ü–æ–ª–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞ –∑–∞–ø—É—Å–∫–∞
```yaml
command: >
  --model rednote-hilab/dots.ocr
  --host 0.0.0.0
  --port 8000
  --trust-remote-code
  --max-model-len 4096  # ‚Üê –£–í–ï–õ–ò–ß–ï–ù–û —Å 1024
  --gpu-memory-utilization 0.85
  --dtype bfloat16
  --enforce-eager
  --disable-log-requests
```

## –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### ‚úÖ –£—Å–ø–µ—à–Ω—ã–µ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–º–ø—Ç—ã (5/6):

1. **üñºÔ∏è –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π** - 1019 —Å–∏–º–≤–æ–ª–æ–≤
   - –í—Ä–µ–º—è: 12.15—Å
   - –û–±–Ω–∞—Ä—É–∂–µ–Ω—ã BBOX –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã
   - JSON —Ñ–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞

2. **üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã** - 830 —Å–∏–º–≤–æ–ª–æ–≤  
   - –í—Ä–µ–º—è: 3.76—Å
   - HTML —Ñ–æ—Ä–º–∞—Ç —Ç–∞–±–ª–∏—Ü
   - BBOX –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã

3. **üìê –¢–æ–ª—å–∫–æ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ (BBOX)** - 440 —Å–∏–º–≤–æ–ª–æ–≤
   - –í—Ä–µ–º—è: 2.14—Å
   - Layout detection –±–µ–∑ —Ç–µ–∫—Å—Ç–∞
   - JSON —Å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º–∏

4. **üî§ –ü—Ä–æ—Å—Ç–æ–µ OCR** - 301 —Å–∏–º–≤–æ–ª–æ–≤
   - –í—Ä–µ–º—è: 1.31—Å
   - –ë—ã—Å—Ç—Ä–æ–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞
   - –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ

5. **üìã –ß—Ç–µ–Ω–∏–µ –ø–æ –ø–æ—Ä—è–¥–∫—É** - 301 —Å–∏–º–≤–æ–ª–æ–≤
   - –í—Ä–µ–º—è: 1.38—Å
   - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ—Ä—è–¥–∫–∞ —á—Ç–µ–Ω–∏—è
   - –ò—Å–∫–ª—é—á–µ–Ω–∏–µ headers/footers

### ‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç (1/6):

1. **üîç –ü–æ–ª–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —Å BBOX** - —Ç–∞–π–º–∞—É—Ç 120 —Å–µ–∫
   - –°–∞–º—ã–π —Å–ª–æ–∂–Ω—ã–π –ø—Ä–æ–º–ø—Ç
   - –¢—Ä–µ–±—É–µ—Ç –ø–æ–ª–Ω–æ–≥–æ JSON –∞–Ω–∞–ª–∏–∑–∞
   - –í–æ–∑–º–æ–∂–Ω–æ –Ω—É–∂–Ω–∞ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è

## –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –º–æ–¥–µ–ª–∏

### –ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:
- **Prompt throughput**: 133-140 tokens/s
- **Generation throughput**: 46-80 tokens/s  
- **GPU KV cache usage**: 0-2.7%
- **Prefix cache hit rate**: 54-68%
- **MM cache hit rate**: 66-80%

### –í—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥–µ–ª–∏:
- –ó–∞–≥—Ä—É–∑–∫–∞ –≤–µ—Å–æ–≤: 45.40 —Å–µ–∫—É–Ω–¥
- –û–±—â–µ–µ –≤—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏: 62.28 —Å–µ–∫—É–Ω–¥
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏: 5.72 GiB

## –õ–æ–≥–∏ —É—Å–ø–µ—à–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

```
(APIServer pid=1) INFO: 172.19.0.1:41984 - "POST /v1/chat/completions HTTP/1.1" 200 OK
(APIServer pid=1) INFO: 172.19.0.1:42718 - "POST /v1/chat/completions HTTP/1.1" 200 OK
(APIServer pid=1) INFO: 172.19.0.1:33720 - "POST /v1/chat/completions HTTP/1.1" 200 OK
(APIServer pid=1) INFO: 172.19.0.1:33732 - "POST /v1/chat/completions HTTP/1.1" 200 OK
(APIServer pid=1) INFO: 172.19.0.1:56828 - "POST /v1/chat/completions HTTP/1.1" 200 OK
```

## –ü—Ä–∏–º–µ—Ä—ã —É—Å–ø–µ—à–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤

### –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π:
```json
[
  {"bbox": [49, 27, 423, 63], "category": "Section-header", "text": "–¢–ï–°–¢–û–í–´–ô –î–û–ö–£–ú–ï–ù–¢"}, 
  {"bbox": [49, 100, 477, 164], "category": "Text", "text": "–≠—Ç–æ —Ç–µ—Å—Ç–æ–≤—ã–π –¥–æ–∫—É–º–µ–Ω—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏\n–æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–º–ø—Ç–æ–≤ dots.ocr"},
  {"bbox": [50, 195, 406, 344], "category": "Table", "text": "<table>...</table>"}
]
```

### –ü—Ä–æ—Å—Ç–æ–µ OCR:
```
# –¢–ï–°–¢–û–í–´–ô –î–û–ö–£–ú–ï–ù–¢

–≠—Ç–æ —Ç–µ—Å—Ç–æ–≤—ã–π –¥–æ–∫—É–º–µ–Ω—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–º–ø—Ç–æ–≤ dots.ocr

<table><thead><tr><td>–ù–∞–∑–≤–∞–Ω–∏–µ</td><td>–ó–Ω–∞—á–µ–Ω–∏–µ</td></tr></thead>
<tbody><tr><td>–¢–µ—Å—Ç 1</td><td>123</td></tr><tr><td>–¢–µ—Å—Ç 2</td><td>456</td></tr></tbody></table>

–§–æ—Ä–º—É–ª–∞: E = mc¬≤

‚Ä¢ –ü—É–Ω–∫—Ç 1
‚Ä¢ –ü—É–Ω–∫—Ç 2  
‚Ä¢ –ü—É–Ω–∫—Ç 3
```

## –°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã

### ‚úÖ –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:
- –ü–µ—Ä–µ–¥–∞—á–∞ –ø—Ä–æ–º–ø—Ç–æ–≤ –∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –≤ vLLM API
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–º–ø—Ç–æ–≤ dots.ocr
- BBOX –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã
- HTML —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü
- JSON —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã
- Layout detection
- –ë—ã—Å—Ç—Ä–æ–µ OCR —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ

### üîß –ß—Ç–æ –Ω—É–∂–Ω–æ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å:
- –ü—Ä–æ–º–ø—Ç "–ü–æ–ª–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —Å BBOX" (—Ç–∞–π–º–∞—É—Ç)
- –í–æ–∑–º–æ–∂–Ω–æ —É–≤–µ–ª–∏—á–∏—Ç—å timeout –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö –ø—Ä–æ–º–ø—Ç–æ–≤
- –†–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—é GPU memory utilization

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. **–î–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π**: –û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–º–ø—Ç—ã —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
2. **–î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤**: –†–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å —É–≤–µ–ª–∏—á–µ–Ω–∏–µ timeout –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö –ø—Ä–æ–º–ø—Ç–æ–≤
3. **–î–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤**: –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ GPU –ø–∞–º—è—Ç–∏ –ø—Ä–∏ 4096 —Ç–æ–∫–µ–Ω–∞—Ö

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

‚úÖ **–ü—Ä–æ–±–ª–µ–º–∞ —Ä–µ—à–µ–Ω–∞**: –û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–º–ø—Ç—ã dots.ocr —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø–æ—Å–ª–µ —É–≤–µ–ª–∏—á–µ–Ω–∏—è –ª–∏–º–∏—Ç–∞ —Ç–æ–∫–µ–Ω–æ–≤ —Å 1024 –¥–æ 4096.

‚úÖ **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: –°–∏—Å—Ç–µ–º–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ö–æ—Ä–æ—à—É—é –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å –Ω–æ–≤—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏.

‚úÖ **–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å**: 5 –∏–∑ 6 –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–º–ø—Ç–æ–≤ —Ä–∞–±–æ—Ç–∞—é—Ç –±–µ–∑ –ø—Ä–æ–±–ª–µ–º.

–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–º–ø—Ç–æ–≤ dots.ocr –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ.