# –£—Å–ø–µ—à–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –ø–µ—Ä–µ–¥–∞—á–∏ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–º–ø—Ç–æ–≤

## –ò—Å—Ö–æ–¥–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–æ–±—â–∏–ª: "–Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É –∏ –ø–µ—Ä–µ–¥–∞—á—É –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–º–ø—Ç–æ–≤ —Ç–µ–∫—Å—Ç–æ–≤—ã–π —á–∞—Ç —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º —Ä–∞–±–æ—Ç–∞–µ—Ç"

## –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–¥–∞—á–∏ –ø—Ä–æ–º–ø—Ç–æ–≤ –∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
‚úÖ **–ë–∞–∑–æ–≤–∞—è –ø–µ—Ä–µ–¥–∞—á–∞ —Ä–∞–±–æ—Ç–∞–ª–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ**
- API –¥–æ—Å—Ç—É–ø–µ–Ω –∏ –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –∑–∞–ø—Ä–æ—Å—ã
- –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –≤ base64
- –ü—Ä–æ—Å—Ç—ã–µ –ø—Ä–æ–º–ø—Ç—ã –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è —É—Å–ø–µ—à–Ω–æ

### 2. –û–±–Ω–∞—Ä—É–∂–µ–Ω–∞ –æ—Å–Ω–æ–≤–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞
‚ùå **–õ–∏–º–∏—Ç —Ç–æ–∫–µ–Ω–æ–≤ –±—ã–ª —Å–ª–∏—à–∫–æ–º –º–∞–ª –¥–ª—è –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–º–ø—Ç–æ–≤**

```
ERROR: 'max_tokens' or 'max_completion_tokens' is too large: 2000. 
This model's maximum context length is 1024 tokens and your request has 218 input tokens 
(2000 > 1024 - 218). (parameter=max_tokens, value=2000)
```

## –†–µ—à–µ–Ω–∏–µ

### –£–≤–µ–ª–∏—á–µ–Ω–∏–µ –ª–∏–º–∏—Ç–∞ —Ç–æ–∫–µ–Ω–æ–≤ –≤ docker-compose-vllm.yml

**–ë–´–õ–û:**
```yaml
command: >
  --model rednote-hilab/dots.ocr
  --max-model-len 1024  # ‚Üê –°–ª–∏—à–∫–æ–º –º–∞–ª–æ –¥–ª—è –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–º–ø—Ç–æ–≤
```

**–°–¢–ê–õ–û:**
```yaml
command: >
  --model rednote-hilab/dots.ocr
  --max-model-len 4096  # ‚Üê –£–≤–µ–ª–∏—á–µ–Ω–æ –≤ 4 —Ä–∞–∑–∞
```

### –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ —Å –Ω–æ–≤—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
```bash
docker stop dots-ocr-fixed
docker rm dots-ocr-fixed
docker-compose -f docker-compose-vllm.yml up -d dots-ocr
```

## –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### ‚úÖ –£—Å–ø–µ—à–Ω—ã–µ —Ç–µ—Å—Ç—ã –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–º–ø—Ç–æ–≤ (5/6):

1. **üñºÔ∏è –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π** - 1019 —Å–∏–º–≤–æ–ª–æ–≤, 12.15—Å
2. **üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã** - 830 —Å–∏–º–≤–æ–ª–æ–≤, 3.76—Å  
3. **üìê –¢–æ–ª—å–∫–æ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ (BBOX)** - 440 —Å–∏–º–≤–æ–ª–æ–≤, 2.14—Å
4. **üî§ –ü—Ä–æ—Å—Ç–æ–µ OCR** - 301 —Å–∏–º–≤–æ–ª–æ–≤, 1.31—Å
5. **üìã –ß—Ç–µ–Ω–∏–µ –ø–æ –ø–æ—Ä—è–¥–∫—É** - 301 —Å–∏–º–≤–æ–ª–æ–≤, 1.38—Å

### ‚ö†Ô∏è –û–¥–∏–Ω –ø—Ä–æ–º–ø—Ç —Å —Ç–∞–π–º–∞—É—Ç–æ–º:
- **üîç –ü–æ–ª–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —Å BBOX** - —Ç–∞–π–º–∞—É—Ç 120 —Å–µ–∫ (—Å–∞–º—ã–π —Å–ª–æ–∂–Ω—ã–π –ø—Ä–æ–º–ø—Ç)

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–∏—Å—Ç–µ–º—ã:
- **Prompt throughput**: 133-140 tokens/s
- **Generation throughput**: 46-80 tokens/s
- **GPU KV cache usage**: 0-2.7%
- **Prefix cache hit rate**: 54-68%

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã –≤ Streamlit

### ‚úÖ –°–∏—Å—Ç–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞:
- Streamlit –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω–æ –Ω–∞ http://localhost:8501
- vLLM API —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- –ü–µ—Ä–µ–¥–∞—á–∞ –ø—Ä–æ–º–ø—Ç–æ–≤ –∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π —Ä–∞–±–æ—Ç–∞–µ—Ç
- –û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–º–ø—Ç—ã –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è —É—Å–ø–µ—à–Ω–æ

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å –∞–∫—Ç–∏–≤–Ω—ã–º–∏ –º–æ–¥–µ–ª—è–º–∏:
- **dots.ocr** (–ø–æ—Ä—Ç 8000) - —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è OCR —Å BBOX
- **Qwen3-VL-2B-Instruct** (–ø–æ—Ä—Ç 8004) - —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è VLM

## –õ–æ–≥–∏ —É—Å–ø–µ—à–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

```
(APIServer pid=1) INFO: 172.19.0.1:41984 - "POST /v1/chat/completions HTTP/1.1" 200 OK
(APIServer pid=1) INFO: 172.19.0.1:42718 - "POST /v1/chat/completions HTTP/1.1" 200 OK
(APIServer pid=1) INFO: 172.19.0.1:33720 - "POST /v1/chat/completions HTTP/1.1" 200 OK
(APIServer pid=1) INFO: 172.19.0.1:49178 - "POST /v1/chat/completions HTTP/1.1" 200 OK
```

## –ü—Ä–∏–º–µ—Ä—ã —É—Å–ø–µ—à–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤

### –ü—Ä–æ—Å—Ç–æ–µ OCR:
```
–¢–ï–°–¢ –î–û–ö–£–ú–ï–ù–¢
–ü—Ä–æ—Å—Ç–æ–π —Ç–µ–∫—Å—Ç –¥–ª—è OCR
–ù–æ–º–µ—Ä: 123-456
Email: test@example.com
```

### BBOX –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ:
```json
[
  {"bbox": [49, 27, 423, 63], "category": "Section-header", "text": "–¢–ï–°–¢–û–í–´–ô –î–û–ö–£–ú–ï–ù–¢"}, 
  {"bbox": [49, 100, 477, 164], "category": "Text", "text": "–≠—Ç–æ —Ç–µ—Å—Ç–æ–≤—ã–π –¥–æ–∫—É–º–µ–Ω—Ç..."},
  {"bbox": [50, 195, 406, 344], "category": "Table", "text": "<table>...</table>"}
]
```

### HTML —Ç–∞–±–ª–∏—Ü—ã:
```html
<table>
<thead><tr><td>–ù–∞–∑–≤–∞–Ω–∏–µ</td><td>–ó–Ω–∞—á–µ–Ω–∏–µ</td></tr></thead>
<tbody><tr><td>–¢–µ—Å—Ç 1</td><td>123</td></tr><tr><td>–¢–µ—Å—Ç 2</td><td>456</td></tr></tbody>
</table>
```

## Single Container Manager

### ‚úÖ –ü—Ä–∏–Ω—Ü–∏–ø –æ–¥–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ:
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É –º–æ–¥–µ–ª—è–º–∏
- –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
- –≠–∫–æ–Ω–æ–º–∏—è GPU –ø–∞–º—è—Ç–∏
- –°—Ç–∞–±–∏–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å–∏—Å—Ç–µ–º—ã

### –ê–∫—Ç–∏–≤–Ω—ã–µ –º–æ–¥–µ–ª–∏:
- **dots.ocr** - –¥–ª—è —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ OCR —Å BBOX
- **Qwen3-VL-2B-Instruct** - –¥–ª—è —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã—Ö VLM –∑–∞–¥–∞—á

## –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### üéØ –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–º–ø—Ç—ã:

1. **–û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ**: http://localhost:8501
2. **–ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ —Ä–µ–∂–∏–º —á–∞—Ç–∞**: "üí¨ –†–µ–∂–∏–º —á–∞—Ç–∞"
3. **–ó–∞–≥—Ä—É–∑–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ** –≤ –ª–µ–≤–æ–π –ø–∞–Ω–µ–ª–∏
4. **–í—ã–±–µ—Ä–∏—Ç–µ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π –ø—Ä–æ–º–ø—Ç** –∏–∑ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω—ã—Ö –∫–Ω–æ–ø–æ–∫:
   - üîç –ü–æ–ª–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —Å BBOX
   - üñºÔ∏è –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π  
   - üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã
   - üìê –¢–æ–ª—å–∫–æ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ (BBOX)
   - üî§ –ü—Ä–æ—Å—Ç–æ–µ OCR
   - üìã –ß—Ç–µ–Ω–∏–µ –ø–æ –ø–æ—Ä—è–¥–∫—É

5. **–ò–ª–∏ –≤–≤–µ–¥–∏—Ç–µ —Å–≤–æ–π –ø—Ä–æ–º–ø—Ç** –≤ –ø–æ–ª–µ —á–∞—Ç–∞

### üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:
- –î–ª—è OCR –∑–∞–¥–∞—á –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ dots.ocr (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è)
- –î–ª—è –∞–Ω–∞–ª–∏–∑–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ Qwen3-VL
- BBOX —Ñ—É–Ω–∫—Ü–∏–∏ –¥–æ—Å—Ç—É–ø–Ω—ã —Ç–æ–ª—å–∫–æ —Å dots.ocr
- –°–ª–æ–∂–Ω—ã–µ –ø—Ä–æ–º–ø—Ç—ã –º–æ–≥—É—Ç –∑–∞–Ω–∏–º–∞—Ç—å –¥–æ 2 –º–∏–Ω—É—Ç

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

‚úÖ **–ü—Ä–æ–±–ª–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ—à–µ–Ω–∞**:
- –û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–º–ø—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- –ü–µ—Ä–µ–¥–∞—á–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –∏ —Ç–µ–∫—Å—Ç–∞ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä—É–µ—Ç
- –°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ–º—É –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é
- –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –æ–ø—Ç–∏–º–∞–ª—å–Ω–∞

‚úÖ **–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é**:
- 5 –∏–∑ 6 –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–º–ø—Ç–æ–≤ —Ä–∞–±–æ—Ç–∞—é—Ç –±–µ–∑ –ø—Ä–æ–±–ª–µ–º
- –í—ã—Å–æ–∫–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (133-140 tokens/s)
- –°—Ç–∞–±–∏–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ Single Container Manager
- –ü–æ–ª–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Streamlit –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º

üéâ **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–º–ø—Ç–æ–≤ dots.ocr!**